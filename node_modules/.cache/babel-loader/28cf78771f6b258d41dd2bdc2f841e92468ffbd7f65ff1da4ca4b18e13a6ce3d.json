{"ast":null,"code":"import _objectSpread from\"/Users/zhangyanjun/react-project/mail/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/zhangyanjun/react-project/mail/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import CalendarPanel from'./calander/index';import Header from'../header';import{message}from'antd';import styles from'./index.module.less';import{getSchedule,getScheduleById,postScheduleInfo}from'@/api/app';import dayjs from'dayjs';import FormBox from'./form';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var current={year:dayjs().year(),month:dayjs().month()+1,day:''};var ScheduleManage=function ScheduleManage(props){var onhandleClose=props.onhandleClose,id=props.id;var _useState=useState(1),_useState2=_slicedToArray(_useState,2),step=_useState2[0],setStep=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),meetingList=_useState4[0],setMeetingList=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),editData=_useState6[0],setEditData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),busyValue=_useState8[0],setBusyValue=_useState8[1];var _useState9=useState(current),_useState10=_slicedToArray(_useState9,1),currentDate=_useState10[0];var title='日程管理';var handleOk=function handleOk(data){if(editData!==null&&editData!==void 0&&editData.id){data.id=editData.id;}else{data.id='';}var othersData={customerId:id,isAllDay:0,startDate:dealTime(data.startDate),endDate:dealTime(data.endDate)};var newData=_objectSpread(_objectSpread({},data),othersData);addSchedule(newData);};var addSchedule=function addSchedule(data){postScheduleInfo(data).then(function(res){console.log(res);message.success('新增成功');getScheduleList(id,currentDate);setStep(1);});};var dealTime=function dealTime(date){return dayjs(date).format('YYYY-MM-DD HH:mm:ss');};var handleDetail=function handleDetail(id){getScheduleById(id).then(function(res){setEditData(res);setStep(2);});};var onhandleAdd=function onhandleAdd(){// 新增事项\nsetStep(2);};var getDayTime=function getDayTime(date){return{year:dayjs(date).year(),month:dayjs(date).month()+1,day:''};};useEffect(function(){getScheduleList(id,currentDate);},[]);var getScheduleList=function getScheduleList(id,date){getSchedule(id,date).then(function(res){setMeetingList(res);getAllMeetingDay(res);});};var dealBusyTime=function dealBusyTime(time){return dayjs(time).year()+'-'+(dayjs(time).month()+1)+'-'+dayjs(time).date();};var getAllMeetingDay=function getAllMeetingDay(res){var arr=[];res.forEach(function(item){arr.push(dealBusyTime(item.startDate));});setBusyValue(arr);};var changeTimeChoose=function changeTimeChoose(time){getScheduleList(id,getDayTime(time));};var getMettingTime=function getMettingTime(time){return dayjs(time).hour()+':'+(dayjs(time).minute()<10?'0'+dayjs(time).minute():dayjs(time).minute());};return/*#__PURE__*/_jsxs(\"div\",{children:[step===1&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{onhandleback:onhandleClose,title:title,onHandleAdd:onhandleAdd,type:'calendar'}),/*#__PURE__*/_jsx(CalendarPanel,{busyValue:busyValue,onChangeTime:changeTimeChoose}),/*#__PURE__*/_jsx(\"div\",{className:styles.jobList,children:/*#__PURE__*/_jsx(\"ul\",{children:meetingList.length>0?meetingList.map(function(item,index){return/*#__PURE__*/_jsxs(\"li\",{onClick:function onClick(){return handleDetail(item.id);},children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.left,children:[getMettingTime(item.startDate),\" \",/*#__PURE__*/_jsx(\"br\",{}),' ',/*#__PURE__*/_jsxs(\"span\",{children:[getMettingTime(item.endDate),\" \"]})]}),/*#__PURE__*/_jsx(\"div\",{className:styles.point}),/*#__PURE__*/_jsx(\"div\",{children:item.title})]},index);}):null})})]}),step===2&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{onhandleback:function onhandleback(){return setStep(1);},title:title,onhandleClose:onhandleClose}),/*#__PURE__*/_jsx(\"div\",{className:styles.formBox,children:/*#__PURE__*/_jsx(FormBox,{handleOk:handleOk,editData:editData})})]})]});};export default ScheduleManage;","map":{"version":3,"names":["React","useEffect","useState","CalendarPanel","Header","message","styles","getSchedule","getScheduleById","postScheduleInfo","dayjs","FormBox","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","current","year","month","day","ScheduleManage","props","onhandleClose","id","_useState","_useState2","_slicedToArray","step","setStep","_useState3","_useState4","meetingList","setMeetingList","_useState5","_useState6","editData","setEditData","_useState7","_useState8","busyValue","setBusyValue","_useState9","_useState10","currentDate","title","handleOk","data","othersData","customerId","isAllDay","startDate","dealTime","endDate","newData","_objectSpread","addSchedule","then","res","console","log","success","getScheduleList","date","format","handleDetail","onhandleAdd","getDayTime","getAllMeetingDay","dealBusyTime","time","arr","forEach","item","push","changeTimeChoose","getMettingTime","hour","minute","children","onhandleback","onHandleAdd","type","onChangeTime","className","jobList","length","map","index","onClick","left","point","formBox"],"sources":["/Users/zhangyanjun/react-project/mail/src/components/scheduleManage/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport CalendarPanel from './calander/index'\nimport Header from '../header'\nimport { message } from 'antd'\nimport styles from './index.module.less'\nimport {\n  ISchedule,\n  getSchedule,\n  getScheduleById,\n  postScheduleInfo,\n} from '@/api/app'\nimport dayjs from 'dayjs'\nimport FormBox from './form'\n\nconst current = {\n  year: dayjs().year(),\n  month: dayjs().month() + 1,\n  day: '',\n}\ntype IProps = {\n  onhandleClose: () => void\n  id: string | undefined\n}\nconst ScheduleManage = (props: IProps) => {\n  const { onhandleClose, id } = props\n  const [step, setStep] = useState(1)\n  const [meetingList, setMeetingList] = useState<ISchedule[]>([])\n  const [editData, setEditData] = useState<ISchedule>()\n  const [busyValue, setBusyValue] = useState<string[]>([])\n  const [currentDate] = useState(current)\n  const title = '日程管理'\n  const handleOk = (data) => {\n    if (editData?.id) {\n      data.id = editData.id\n    } else {\n      data.id = ''\n    }\n    const othersData = {\n      customerId: id,\n      isAllDay: 0,\n      startDate: dealTime(data.startDate),\n      endDate: dealTime(data.endDate),\n    }\n    const newData = {\n      ...data,\n      ...othersData,\n    }\n    addSchedule(newData)\n  }\n  const addSchedule = (data) => {\n    postScheduleInfo(data).then((res) => {\n      console.log(res)\n      message.success('新增成功')\n      getScheduleList(id, currentDate)\n      setStep(1)\n    })\n  }\n  const dealTime = (date) => {\n    return dayjs(date).format('YYYY-MM-DD HH:mm:ss')\n  }\n  const handleDetail = (id) => {\n    getScheduleById(id).then((res) => {\n      setEditData(res)\n      setStep(2)\n    })\n  }\n\n  const onhandleAdd = () => {\n    // 新增事项\n    setStep(2)\n  }\n  const getDayTime = (date) => {\n    return {\n      year: dayjs(date).year(),\n      month: dayjs(date).month() + 1,\n      day: '',\n    }\n  }\n  useEffect(() => {\n    getScheduleList(id, currentDate)\n  }, [])\n  const getScheduleList = (id, date) => {\n    getSchedule(id, date).then((res) => {\n      setMeetingList(res)\n      getAllMeetingDay(res)\n    })\n  }\n  const dealBusyTime = (time) => {\n    return (\n      dayjs(time).year() +\n      '-' +\n      (dayjs(time).month() + 1) +\n      '-' +\n      dayjs(time).date()\n    )\n  }\n  const getAllMeetingDay = (res) => {\n    const arr: string[] = []\n    res.forEach((item) => {\n      arr.push(dealBusyTime(item.startDate))\n    })\n    setBusyValue(arr)\n  }\n  const changeTimeChoose = (time) => {\n    getScheduleList(id, getDayTime(time))\n  }\n  const getMettingTime = (time) => {\n    return (\n      dayjs(time).hour() +\n      ':' +\n      (dayjs(time).minute() < 10\n        ? '0' + dayjs(time).minute()\n        : dayjs(time).minute())\n    )\n  }\n  return (\n    <div>\n      {step === 1 && (\n        <>\n          <Header\n            onhandleback={onhandleClose}\n            title={title}\n            onHandleAdd={onhandleAdd}\n            type={'calendar'}\n          />\n          <CalendarPanel\n            busyValue={busyValue}\n            onChangeTime={changeTimeChoose}\n          />\n          <div className={styles.jobList}>\n            <ul>\n              {meetingList.length > 0\n                ? meetingList.map((item, index) => {\n                    return (\n                      <li key={index} onClick={() => handleDetail(item.id)}>\n                        <div className={styles.left}>\n                          {getMettingTime(item.startDate)} <br />{' '}\n                          <span>{getMettingTime(item.endDate)} </span>\n                        </div>\n                        <div className={styles.point}></div>\n                        <div>{item.title}</div>\n                      </li>\n                    )\n                  })\n                : null}\n            </ul>\n          </div>\n        </>\n      )}\n      {step === 2 && (\n        <>\n          <Header\n            onhandleback={() => setStep(1)}\n            title={title}\n            onhandleClose={onhandleClose}\n          />\n          <div className={styles.formBox}>\n            <FormBox handleOk={handleOk} editData={editData} />\n          </div>\n        </>\n      )}\n    </div>\n  )\n}\nexport default ScheduleManage\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}